# Seção 03 - Integração do Protocolo de Contexto de Modelo (MCP)

## Introdução ao MCP (Protocolo de Contexto de Modelo)

O Protocolo de Contexto de Modelo (MCP) é um padrão de código aberto para conectar aplicações de IA a sistemas externos. Usando o MCP, aplicações de IA como Claude ou ChatGPT podem se conectar a fontes de dados (por exemplo, arquivos locais, bases de dados), ferramentas (por exemplo, motores de busca, calculadoras) e fluxos de trabalho (por exemplo, prompts especializados), permitindo acesso a informações importantes e execução de tarefas.

Pense no MCP como uma **porta USB-C para aplicações de IA**. Assim como o USB-C oferece uma forma padronizada de conectar dispositivos eletrônicos, o MCP oferece uma forma padronizada de conectar aplicações de IA a sistemas externos.

### O que o MCP pode possibilitar?

O MCP desbloqueia capacidades poderosas para aplicações de IA:

- **Assistentes de IA Personalizados**: Agentes podem acessar o seu Google Calendar e Notion, atuando como um assistente de IA mais personalizado
- **Geração Avançada de Código**: Claude Code pode gerar um aplicativo web inteiro usando um design do Figma
- **Integração de Dados Empresariais**: Chatbots empresariais podem se conectar a múltiplas bases de dados de uma organização, permitindo que os usuários analisem dados por meio de chat
- **Fluxos de Trabalho Criativos**: Modelos de IA podem criar designs 3D no Blender e imprimi-los usando uma impressora 3D
- **Acesso a Informações em Tempo Real**: Conexão com fontes de dados externas para informações atualizadas
- **Operações Complexas em Vários Passos**: Realização de fluxos de trabalho sofisticados combinando várias ferramentas e sistemas

### Por que o MCP é importante?

O MCP oferece benefícios em todo o ecossistema:

**Para Desenvolvedores**: O MCP reduz o tempo e a complexidade de desenvolvimento ao criar ou integrar uma aplicação ou agente de IA.

**Para Aplicações de IA**: O MCP fornece acesso a um ecossistema de fontes de dados, ferramentas e aplicativos que ampliam as capacidades e melhoram a experiência do usuário final.

**Para Usuários Finais**: O MCP resulta em aplicações ou agentes de IA mais capazes, que podem acessar seus dados e tomar ações em seu nome quando necessário.

## Modelos de Linguagem Pequenos (SLMs) no MCP

Os Modelos de Linguagem Pequenos representam uma abordagem eficiente para a implementação de IA, oferecendo várias vantagens:

### Benefícios dos SLMs
- **Eficiência de Recursos**: Requisitos computacionais mais baixos
- **Respostas Mais Rápidas**: Menor latência para aplicações em tempo real  
- **Custo-benefício**: Necessidades mínimas de infraestrutura
- **Privacidade**: Podem ser executados localmente sem transmissão de dados
- **Personalização**: Mais fácil de ajustar para domínios específicos

### Por que os SLMs funcionam bem com o MCP

SLMs combinados com o MCP criam uma combinação poderosa onde as capacidades de raciocínio do modelo são ampliadas por ferramentas externas, compensando o menor número de parâmetros com funcionalidades aprimoradas.

## Visão Geral do SDK Python MCP

O SDK Python MCP fornece a base para construir aplicações habilitadas para MCP. O SDK inclui:

- **Bibliotecas de Cliente**: Para conectar-se a servidores MCP
- **Framework de Servidor**: Para criar servidores MCP personalizados
- **Manipuladores de Protocolo**: Para gerenciar a comunicação
- **Integração de Ferramentas**: Para executar funções externas

## Implementação Prática: Cliente MCP Phi-4

Vamos explorar uma implementação real usando o modelo mini Phi-4 da Microsoft integrado com capacidades MCP.

### Visão Geral da Arquitetura MCP

O MCP segue uma **arquitetura cliente-servidor**, onde um host MCP (uma aplicação de IA como Claude Code ou Claude Desktop) estabelece conexões com um ou mais servidores MCP. O host MCP realiza isso criando um cliente MCP para cada servidor MCP.

#### Participantes Principais

- **Host MCP**: A aplicação de IA que coordena e gerencia um ou vários clientes MCP
- **Cliente MCP**: Um componente que mantém uma conexão com um servidor MCP e obtém contexto de um servidor MCP para o host MCP usar
- **Servidor MCP**: Um programa que fornece contexto para clientes MCP

#### Arquitetura de Duas Camadas

O MCP consiste em duas camadas distintas:

**Camada de Dados**: Define o protocolo baseado em JSON-RPC para comunicação cliente-servidor, incluindo:
- Gerenciamento de ciclo de vida (inicialização de conexão, negociação de capacidades)
- Primitivas principais (ferramentas, recursos, prompts)
- Funcionalidades do cliente (amostragem, elicitação, registro)
- Funcionalidades utilitárias (notificações, rastreamento de progresso)

**Camada de Transporte**: Define os mecanismos e canais de comunicação:
- **Transporte STDIO**: Usa fluxos de entrada/saída padrão para processos locais (desempenho ideal, sem sobrecarga de rede)
- **Transporte HTTP com Streaming**: Usa HTTP POST com eventos enviados pelo servidor opcionalmente para servidores remotos (suporta autenticação HTTP padrão)

```
┌─────────────────────────────────────┐
│           MCP Host                  │
│     (AI Application)                │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Client 1                │
│  ┌─────────────────────────────────┐ │
│  │        Data Layer               │ │
│  │  ├── Lifecycle Management       │ │
│  │  ├── Primitives (Tools/Resources)│ │
│  │  └── Notifications              │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │      Transport Layer           │ │
│  │  ├── STDIO Transport           │ │
│  │  └── HTTP Transport            │ │
│  └─────────────────────────────────┘ │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Server 1                │
│    (Local/Remote Context Provider)  │
└─────────────────────────────────────┘
```

### Primitivas Centrais do MCP

O MCP define primitivas que especificam os tipos de informações contextuais que podem ser compartilhadas com aplicações de IA e o alcance das ações que podem ser realizadas.

#### Primitivas do Servidor

O MCP define três primitivas principais que os servidores podem expor:

**Ferramentas**: Funções executáveis que aplicações de IA podem invocar para realizar ações
- Exemplos: operações de arquivo, chamadas de API, consultas a bases de dados
- Métodos: `tools/list`, `tools/call`
- Suporte à descoberta e execução dinâmica

**Recursos**: Fontes de dados que fornecem informações contextuais para aplicações de IA
- Exemplos: conteúdos de arquivos, registros de bases de dados, respostas de API
- Métodos: `resources/list`, `resources/read`
- Permitem acesso a dados estruturados

**Prompts**: Modelos reutilizáveis que ajudam a estruturar interações com modelos de linguagem
- Exemplos: prompts de sistema, exemplos de poucos disparos
- Métodos: `prompts/list`, `prompts/get`
- Padronizam os padrões de interação com IA

#### Primitivas do Cliente

O MCP também define primitivas que os clientes podem expor para permitir interações mais ricas:

**Amostragem**: Permite que os servidores solicitem conclusões de modelos de linguagem da aplicação de IA do cliente
- Método: `sampling/complete`
- Permite o desenvolvimento de servidores independentes de modelo
- Fornece acesso ao modelo de linguagem do host

**Elicitação**: Permite que os servidores solicitem informações adicionais dos usuários
- Método: `elicitation/request`
- Permite interação e confirmação do usuário
- Suporta coleta dinâmica de informações

**Registro**: Permite que os servidores enviem mensagens de registro para os clientes
- Usado para depuração e monitoramento
- Fornece visibilidade nas operações do servidor

### Ciclo de Vida do Protocolo MCP

#### Inicialização e Negociação de Capacidades

O MCP é um protocolo com estado que requer gerenciamento de ciclo de vida. O processo de inicialização serve a vários propósitos críticos:

1. **Negociação de Versão do Protocolo**: Garante que tanto o cliente quanto o servidor usem versões compatíveis do protocolo (por exemplo, "2025-06-18")
2. **Descoberta de Capacidades**: Cada parte declara os recursos e primitivas suportados
3. **Troca de Identidade**: Fornece informações de identificação e versão

```python
# Example initialization request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2025-06-18",
    "capabilities": {
      "elicitation": {},  # Client supports user interaction
      "sampling": {}      # Client can provide LLM completions
    },
    "clientInfo": {
      "name": "edge-ai-client",
      "version": "1.0.0"
    }
  }
}
```

#### Descoberta e Execução de Ferramentas

Após a inicialização, os clientes podem descobrir e executar ferramentas:

```python
# Discover available tools
tools_response = await session.list_tools()

# Execute a tool
result = await session.call_tool(
    "weather_current",
    {
        "location": "San Francisco",
        "units": "imperial"
    }
)
```

#### Notificações em Tempo Real

O MCP suporta notificações em tempo real para atualizações dinâmicas:

```python
# Server sends notification when tools change
{
  "jsonrpc": "2.0",
  "method": "notifications/tools/list_changed"
}

# Client responds by refreshing tool list
await session.list_tools()  # Get updated tools
```

## Primeiros Passos: Guia Passo a Passo

### Passo 1: Configuração do Ambiente

Instale as dependências necessárias:
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```

### Passo 2: Configuração Básica

Configure suas variáveis de ambiente:
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```

### Passo 3: Executando Seu Primeiro Cliente MCP

**Configuração Básica do Ollama:**
```bash
python ghmodel_mcp_demo.py
```

**Usando Backend vLLM:**
```bash
python ghmodel_mcp_demo.py --env vllm
```

**Conexão com Eventos Enviados pelo Servidor:**
```bash
python ghmodel_mcp_demo.py --run sse
```

**Servidor MCP Personalizado:**
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```

### Passo 4: Uso Programático

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Funcionalidades Avançadas

### Suporte a Múltiplos Backends

A implementação suporta os backends Ollama e vLLM, permitindo que você escolha com base em suas necessidades:

- **Ollama**: Melhor para desenvolvimento e testes locais
- **vLLM**: Otimizado para produção e cenários de alta demanda

### Protocolos de Conexão Flexíveis

Dois modos de conexão são suportados:

**Modo STDIO**: Comunicação direta entre processos
- Menor latência
- Adequado para ferramentas locais
- Configuração simples

**Modo SSE**: Streaming baseado em HTTP
- Capaz de rede
- Melhor para sistemas distribuídos
- Atualizações em tempo real

### Capacidades de Integração de Ferramentas

O sistema pode integrar-se com várias ferramentas:
- Automação web (Playwright)
- Operações de arquivo
- Interações com APIs
- Comandos de sistema
- Funções personalizadas

## Tratamento de Erros e Melhores Práticas

### Gerenciamento Abrangente de Erros

A implementação inclui tratamento robusto de erros para:

**Erros de Conexão:**
- Falhas no servidor MCP
- Timeouts de rede
- Problemas de conectividade

**Erros de Execução de Ferramentas:**
- Ferramentas ausentes
- Validação de parâmetros
- Falhas de execução

**Erros de Processamento de Respostas:**
- Problemas de análise JSON
- Inconsistências de formato
- Anomalias nas respostas do LLM

### Melhores Práticas

1. **Gerenciamento de Recursos**: Use gerenciadores de contexto assíncronos
2. **Tratamento de Erros**: Implemente blocos try-catch abrangentes
3. **Registro**: Ative níveis de registro apropriados
4. **Segurança**: Valide entradas e sanitize saídas
5. **Desempenho**: Use agrupamento de conexões e cache

## Aplicações Reais

### Automação Web
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```

### Processamento de Dados
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```

### Integração com APIs
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```

## Otimização de Desempenho

### Gerenciamento de Memória
- Manipulação eficiente do histórico de mensagens
- Limpeza adequada de recursos
- Agrupamento de conexões

### Otimização de Rede
- Operações HTTP assíncronas
- Timeouts configuráveis
- Recuperação de erros de forma graciosa

### Processamento Concorrente
- I/O não bloqueante
- Execução paralela de ferramentas
- Padrões assíncronos eficientes

## Considerações de Segurança

### Proteção de Dados
- Gerenciamento seguro de chaves de API
- Validação de entradas
- Sanitização de saídas

### Segurança de Rede
- Suporte a HTTPS
- Padrões locais de endpoint
- Manipulação segura de tokens

### Segurança de Execução
- Filtragem de ferramentas
- Ambientes isolados
- Registro de auditoria

## Ecossistema e Desenvolvimento do MCP

### Escopo do Projeto MCP

O ecossistema do Protocolo de Contexto de Modelo inclui vários componentes-chave:

- **[Especificação MCP](https://modelcontextprotocol.io/specification/latest)**: Especificação oficial que descreve os requisitos de implementação para clientes e servidores
- **[SDKs MCP](https://modelcontextprotocol.io/docs/sdk)**: SDKs para diferentes linguagens de programação que implementam o MCP
- **Ferramentas de Desenvolvimento MCP**: Ferramentas para desenvolver servidores e clientes MCP, incluindo o [MCP Inspector](https://github.com/modelcontextprotocol/inspector)
- **[Implementações de Servidores de Referência MCP](https://github.com/modelcontextprotocol/servers)**: Implementações de referência de servidores MCP

### Começando com o Desenvolvimento MCP

Para começar a construir com o MCP:

**Construir Servidores**: [Crie servidores MCP](https://modelcontextprotocol.io/docs/develop/build-server) para expor seus dados e ferramentas

**Construir Clientes**: [Desenvolva aplicações](https://modelcontextprotocol.io/docs/develop/build-client) que se conectem a servidores MCP

**Aprender Conceitos**: [Compreenda os conceitos principais](https://modelcontextprotocol.io/docs/learn/architecture) e a arquitetura do MCP

## Conclusão

SLMs integrados com MCP representam uma mudança de paradigma no desenvolvimento de aplicações de IA. Ao combinar a eficiência de modelos pequenos com o poder de ferramentas externas, os desenvolvedores podem criar sistemas inteligentes que são ao mesmo tempo eficientes em recursos e altamente capazes.

O Protocolo de Contexto de Modelo fornece uma maneira padronizada de conectar aplicações de IA a sistemas externos, assim como o USB-C oferece um padrão universal de conexão para dispositivos eletrônicos. Essa padronização possibilita:

- **Integração Sem Esforço**: Conectar modelos de IA a diversas fontes de dados e ferramentas
- **Crescimento do Ecossistema**: Construir uma vez, usar em várias aplicações de IA
- **Capacidades Aprimoradas**: Ampliar os SLMs com funcionalidades externas
- **Atualizações em Tempo Real**: Suporte a aplicações de IA dinâmicas e responsivas

Principais pontos:
- O MCP é um padrão aberto que conecta aplicações de IA a sistemas externos
- O protocolo suporta ferramentas, recursos e prompts como primitivas principais
- Notificações em tempo real permitem aplicações dinâmicas e responsivas
- Gerenciamento de ciclo de vida e tratamento de erros são essenciais para uso em produção
- O ecossistema oferece SDKs abrangentes e ferramentas de desenvolvimento

## Referências e Leituras Adicionais

### Documentação Oficial do MCP

- **[Site Oficial do Protocolo de Contexto de Modelo](https://modelcontextprotocol.io/)** - Documentação completa e especificações
- **[Guia de Introdução ao MCP](https://modelcontextprotocol.io/docs/getting-started/intro)** - Introdução e conceitos principais
- **[Visão Geral da Arquitetura MCP](https://modelcontextprotocol.io/docs/learn/architecture)** - Arquitetura técnica detalhada
- **[Especificação MCP](https://modelcontextprotocol.io/specification/latest)** - Especificação oficial do protocolo
- **[Documentação dos SDKs MCP](https://modelcontextprotocol.io/docs/sdk)** - Guias específicos para SDKs por linguagem

### Recursos de Desenvolvimento

- **[MCP para Iniciantes](https://aka.ms/mcp-for-beginners)** - Guia abrangente para iniciantes no Protocolo de Contexto de Modelo
- **[Organização GitHub do MCP](https://github.com/modelcontextprotocol)** - Repositórios e exemplos oficiais
- **[Repositório de Servidores MCP](https://github.com/modelcontextprotocol/servers)** - Implementações de servidores de referência
- **[MCP Inspector](https://github.com/modelcontextprotocol/inspector)** - Ferramenta de desenvolvimento e depuração
- **[Guia para Construir Servidores MCP](https://modelcontextprotocol.io/docs/develop/build-server)** - Tutorial de desenvolvimento de servidores
- **[Guia para Construir Clientes MCP](https://modelcontextprotocol.io/docs/develop/build-client)** - Tutorial de desenvolvimento de clientes

### Modelos de Linguagem Pequenos e IA de Borda

- **[Modelos Phi da Microsoft](https://aka.ms/phicookbook)** - Família de modelos Phi 
- **[Documentação Local Foundry](https://github.com/microsoft/Foundry-Local)** - Runtime de IA de borda da Microsoft
- **[Documentação do Ollama](https://ollama.ai/docs)** - Plataforma de implementação local de LLM
- **[Documentação do vLLM](https://docs.vllm.ai/)** - Serviço de LLM de alto desempenho

### Normas Técnicas e Protocolos

- **[Especificação JSON-RPC 2.0](https://www.jsonrpc.org/)** - Protocolo RPC subjacente usado pelo MCP
- **[JSON Schema](https://json-schema.org/)** - Padrão de definição de esquema para ferramentas MCP
- **[Especificação OpenAPI](https://swagger.io/specification/)** - Padrão de documentação de API
- **[Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)** - Padrão web para atualizações em tempo real

### Desenvolvimento de Agentes de IA

- **[Microsoft Agent Framework](https://github.com/microsoft/agent-framework)** - Desenvolvimento de agentes prontos para produção
- **[Documentação do LangChain](https://docs.langchain.com/)** - Framework de integração de agentes e ferramentas
- **[Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/)** - SDK de orquestração de IA da Microsoft

### Relatórios e Pesquisas da Indústria

- **[Anúncio do Protocolo de Contexto de Modelo da Anthropic](https://www.anthropic.com/news/model-context-protocol)** - Introdução original ao MCP
- **[Pesquisa sobre Modelos de Linguagem Pequenos](https://arxiv.org/abs/2410.20011)** - Pesquisa acadêmica sobre SLM
- **[Análise de Mercado de Edge AI](https://www.marketsandmarkets.com/Market-Reports/edge-ai-software-market-74385617.html)** - Tendências e previsões da indústria
- **[Melhores Práticas para Desenvolvimento de Agentes de IA](https://arxiv.org/abs/2309.02427)** - Pesquisa sobre arquiteturas de agentes

Esta seção fornece a base para construir suas próprias aplicações MCP alimentadas por SLM, abrindo possibilidades para automação, processamento de dados e integração de sistemas inteligentes.

## ➡️ Próximos passos

- [Módulo 7. Exemplos de Edge AI](../Module07/README.md)

---

**Aviso**:  
Este documento foi traduzido utilizando o serviço de tradução por IA [Co-op Translator](https://github.com/Azure/co-op-translator). Embora nos esforcemos pela precisão, esteja ciente de que traduções automáticas podem conter erros ou imprecisões. O documento original na sua língua nativa deve ser considerado a fonte autoritária. Para informações críticas, recomenda-se uma tradução profissional realizada por humanos. Não nos responsabilizamos por quaisquer mal-entendidos ou interpretações incorretas decorrentes do uso desta tradução.