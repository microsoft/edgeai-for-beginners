# Sektsioon 03 - Mudeli Konteksti Protokolli (MCP) integreerimine

## Sissejuhatus MCP-sse (Mudeli Konteksti Protokoll)

Mudeli Konteksti Protokoll (MCP) on avatud lähtekoodiga standard, mis võimaldab AI-rakendustel ühenduda väliste süsteemidega. MCP abil saavad AI-rakendused nagu Claude või ChatGPT ühenduda andmeallikatega (nt kohalikud failid, andmebaasid), tööriistadega (nt otsingumootorid, kalkulaatorid) ja töövoogudega (nt spetsialiseeritud juhised), võimaldades neil pääseda olulisele teabele ja täita ülesandeid.

Mõelge MCP-st kui **USB-C pordist AI-rakenduste jaoks**. Nii nagu USB-C pakub standardiseeritud viisi elektroonikaseadmete ühendamiseks, pakub MCP standardiseeritud viisi AI-rakenduste ühendamiseks väliste süsteemidega.

### Mida MCP võimaldab?

MCP avab AI-rakendustele võimsad võimalused:

- **Isikupärastatud AI assistendid**: Agendid saavad juurdepääsu teie Google Kalendrile ja Notionile, toimides isikupärasema AI assistendina
- **Täiustatud koodi genereerimine**: Claude Code suudab luua terve veebirakenduse Figma disaini põhjal
- **Ettevõtte andmete integreerimine**: Ettevõtte vestlusrobotid saavad ühenduda mitme andmebaasiga organisatsioonis, võimaldades kasutajatel andmeid analüüsida vestluse kaudu
- **Loomingulised töövood**: AI mudelid saavad luua 3D disaine Blenderis ja printida need 3D printeriga
- **Reaalajas teabe juurdepääs**: Ühendus väliste andmeallikatega ajakohase teabe saamiseks
- **Komplekssed mitmeetapilised operatsioonid**: Täiustatud töövood, mis ühendavad mitmeid tööriistu ja süsteeme

### Miks MCP on oluline?

MCP pakub eeliseid kogu ökosüsteemis:

**Arendajatele**: MCP vähendab arendusaega ja keerukust AI-rakenduse või agendi loomisel või integreerimisel.

**AI-rakendustele**: MCP pakub juurdepääsu andmeallikate, tööriistade ja rakenduste ökosüsteemile, mis suurendab võimekust ja parandab lõppkasutaja kogemust.

**Lõppkasutajatele**: MCP tulemuseks on võimekamad AI-rakendused või agendid, mis saavad vajadusel teie andmetele juurde pääseda ja teie nimel tegutseda.

## Väikesed keelemudelid (SLM-id) MCP-s

Väikesed keelemudelid esindavad tõhusat lähenemist AI kasutuselevõtule, pakkudes mitmeid eeliseid:

### SLM-ide eelised
- **Ressursitõhusus**: Madalamad arvutusnõuded
- **Kiirem reageerimisaeg**: Vähenenud latentsus reaalajas rakenduste jaoks  
- **Kulutõhusus**: Minimaalsed infrastruktuuri vajadused
- **Privaatsus**: Võimalik töötada lokaalselt ilma andmeedastuseta
- **Kohandatavus**: Lihtsam kohandada spetsiifilistele valdkondadele

### Miks SLM-id sobivad hästi MCP-ga

SLM-id koos MCP-ga loovad võimsa kombinatsiooni, kus mudeli loogilised võimed on täiendatud väliste tööriistadega, kompenseerides nende väiksemat parameetrite arvu täiustatud funktsionaalsusega.

## Python MCP SDK ülevaade

Python MCP SDK pakub alust MCP-toega rakenduste loomiseks. SDK sisaldab:

- **Klienditeeke**: MCP serveritega ühenduse loomiseks
- **Serveriraamistikku**: Kohandatud MCP serverite loomiseks
- **Protokolli haldureid**: Kommunikatsiooni haldamiseks
- **Tööriistade integreerimist**: Väliste funktsioonide täitmiseks

## Praktiline rakendus: Phi-4 MCP klient

Vaatame reaalset rakendust, kus Microsofti Phi-4 mini mudel on integreeritud MCP võimekusega.

### MCP arhitektuuri ülevaade

MCP järgib **kliendi-serveri arhitektuuri**, kus MCP host (AI rakendus nagu Claude Code või Claude Desktop) loob ühendused ühe või mitme MCP serveriga. MCP host saavutab selle, luues iga MCP serveri jaoks ühe MCP kliendi.

#### Peamised osalejad

- **MCP host**: AI rakendus, mis koordineerib ja haldab ühte või mitut MCP klienti
- **MCP klient**: Komponent, mis hoiab ühendust MCP serveriga ja hangib konteksti MCP serverilt, et MCP host saaks seda kasutada
- **MCP server**: Programm, mis pakub konteksti MCP klientidele

#### Kahekihiline arhitektuur

MCP koosneb kahest eraldi kihist:

**Andmekiht**: Määratleb JSON-RPC-põhise protokolli kliendi-serveri kommunikatsiooniks, sealhulgas:
- Elutsükli haldus (ühenduse algatamine, võimekuse läbirääkimine)
- Põhiprimitiivid (tööriistad, ressursid, juhised)
- Kliendi funktsioonid (näidistamine, teabe kogumine, logimine)
- Kasulikkuse funktsioonid (teavitused, edenemise jälgimine)

**Transpordikiht**: Määratleb kommunikatsioonimehhanismid ja -kanalid:
- **STDIO transport**: Kasutab standardseid sisend/väljund vooge kohalike protsesside jaoks (optimaalne jõudlus, puudub võrgu koormus)
- **Streamable HTTP transport**: Kasutab HTTP POST-i koos valikuliste serveripoolsete sündmustega kaugserverite jaoks (toetab standardset HTTP autentimist)

```
┌─────────────────────────────────────┐
│           MCP Host                  │
│     (AI Application)                │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Client 1                │
│  ┌─────────────────────────────────┐ │
│  │        Data Layer               │ │
│  │  ├── Lifecycle Management       │ │
│  │  ├── Primitives (Tools/Resources)│ │
│  │  └── Notifications              │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │      Transport Layer           │ │
│  │  ├── STDIO Transport           │ │
│  │  └── HTTP Transport            │ │
│  └─────────────────────────────────┘ │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Server 1                │
│    (Local/Remote Context Provider)  │
└─────────────────────────────────────┘
```

### MCP põhiprimitiivid

MCP määratleb primitiivid, mis täpsustavad kontekstuaalse teabe tüüpe, mida saab AI-rakendustega jagada, ja toimingute ulatust, mida saab teostada.

#### Serveri primitiivid

MCP määratleb kolm põhiprimitiivi, mida serverid saavad pakkuda:

**Tööriistad**: Käivitatavad funktsioonid, mida AI rakendused saavad kasutada toimingute tegemiseks
- Näited: failitoimingud, API-kutsed, andmebaasi päringud
- Meetodid: `tools/list`, `tools/call`
- Toetavad dünaamilist avastamist ja täitmist

**Ressursid**: Andmeallikad, mis pakuvad AI rakendustele kontekstuaalset teavet
- Näited: failisisu, andmebaasi kirjed, API vastused
- Meetodid: `resources/list`, `resources/read`
- Võimaldavad juurdepääsu struktureeritud andmetele

**Juhised**: Taaskasutatavad mallid, mis aitavad struktureerida suhtlust keelemudelitega
- Näited: süsteemijuhised, näited
- Meetodid: `prompts/list`, `prompts/get`
- Standardiseerivad AI suhtlusmustrid

#### Kliendi primitiivid

MCP määratleb ka primitiivid, mida kliendid saavad pakkuda rikkamate interaktsioonide võimaldamiseks:

**Näidistamine**: Võimaldab serveritel taotleda keelemudeli täiendusi kliendi AI rakenduselt
- Meetod: `sampling/complete`
- Võimaldab mudelist sõltumatut serveri arendust
- Pakub juurdepääsu hosti keelemudelile

**Teabe kogumine**: Võimaldab serveritel taotleda kasutajatelt täiendavat teavet
- Meetod: `elicitation/request`
- Võimaldab kasutajate interaktsiooni ja kinnitust
- Toetab dünaamilist teabe kogumist

**Logimine**: Võimaldab serveritel saata logisõnumeid klientidele
- Kasutatakse silumiseks ja jälgimiseks
- Pakub nähtavust serveri toimingutesse

### MCP protokolli elutsükkel

#### Algatamine ja võimekuse läbirääkimine

MCP on olekuga protokoll, mis nõuab elutsükli haldust. Algatamisprotsess täidab mitmeid kriitilisi eesmärke:

1. **Protokolli versiooni läbirääkimine**: Tagab, et nii klient kui server kasutavad ühilduvaid protokolli versioone (nt "2025-06-18")
2. **Võimekuse avastamine**: Mõlemad osapooled deklareerivad toetatud funktsioonid ja primitiivid
3. **Identiteedi vahetus**: Pakub identifitseerimis- ja versiooniteavet

```python
# Example initialization request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2025-06-18",
    "capabilities": {
      "elicitation": {},  # Client supports user interaction
      "sampling": {}      # Client can provide LLM completions
    },
    "clientInfo": {
      "name": "edge-ai-client",
      "version": "1.0.0"
    }
  }
}
```

#### Tööriistade avastamine ja täitmine

Pärast algatamist saavad kliendid avastada ja täita tööriistu:

```python
# Discover available tools
tools_response = await session.list_tools()

# Execute a tool
result = await session.call_tool(
    "weather_current",
    {
        "location": "San Francisco",
        "units": "imperial"
    }
)
```

#### Reaalajas teavitused

MCP toetab reaalajas teavitusi dünaamiliste uuenduste jaoks:

```python
# Server sends notification when tools change
{
  "jsonrpc": "2.0",
  "method": "notifications/tools/list_changed"
}

# Client responds by refreshing tool list
await session.list_tools()  # Get updated tools
```

## Alustamine: Samm-sammuline juhend

### Samm 1: Keskkonna seadistamine

Paigaldage vajalikud sõltuvused:
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```

### Samm 2: Põhikohandamine

Seadistage oma keskkonnamuutujad:
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```

### Samm 3: Esimese MCP kliendi käivitamine

**Põhiline Ollama seadistus:**
```bash
python ghmodel_mcp_demo.py
```

**vLLM taustaprogrammi kasutamine:**
```bash
python ghmodel_mcp_demo.py --env vllm
```

**Serveripoolsete sündmuste ühendus:**
```bash
python ghmodel_mcp_demo.py --run sse
```

**Kohandatud MCP server:**
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```

### Samm 4: Programmiline kasutamine

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Täiustatud funktsioonid

### Mitme taustaprogrammi tugi

Rakendus toetab nii Ollama kui vLLM taustaprogramme, võimaldades valida vastavalt vajadustele:

- **Ollama**: Sobib paremini kohalikuks arenduseks ja testimiseks
- **vLLM**: Optimeeritud tootmise ja suure läbilaskevõimega stsenaariumide jaoks

### Paindlikud ühendusprotokollid

Toetatud on kaks ühendusrežiimi:

**STDIO režiim**: Otsene protsessidevaheline kommunikatsioon
- Madalam latentsus
- Sobib kohalike tööriistade jaoks
- Lihtne seadistus

**SSE režiim**: HTTP-põhine voogedastus
- Võrgukõlbulik
- Sobib paremini hajutatud süsteemide jaoks
- Reaalajas uuendused

### Tööriistade integreerimise võimalused

Süsteem saab integreeruda erinevate tööriistadega:
- Veebi automatiseerimine (Playwright)
- Failitoimingud
- API interaktsioonid
- Süsteemikäsklused
- Kohandatud funktsioonid

## Vigade käsitlemine ja parimad tavad

### Põhjalik vigade haldamine

Rakendus sisaldab tugevat vigade käsitlemist:

**Ühenduse vead:**
- MCP serveri tõrked
- Võrgu ajastuse ületamised
- Ühenduvusprobleemid

**Tööriistade täitmise vead:**
- Puuduvad tööriistad
- Parameetrite valideerimine
- Täitmise tõrked

**Vastuste töötlemise vead:**
- JSON-i parsimise probleemid
- Vorminguprobleemid
- LLM-i vastuste anomaaliad

### Parimad tavad

1. **Ressursside haldamine**: Kasutage asünkroonseid kontekstihaldureid
2. **Vigade käsitlemine**: Rakendage põhjalikke try-catch plokke
3. **Logimine**: Lubage sobivad logimistasemed
4. **Turvalisus**: Valideerige sisendid ja puhastage väljundid
5. **Jõudlus**: Kasutage ühenduse ühendamist ja vahemällu salvestamist

## Reaalsed rakendused

### Veebi automatiseerimine
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```

### Andmetöötlus
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```

### API integreerimine
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```

## Jõudluse optimeerimine

### Mälu haldamine
- Tõhus sõnumite ajaloo haldamine
- Ressursside korrektne puhastamine
- Ühenduse ühendamine

### Võrgu optimeerimine
- Asünkroonsed HTTP operatsioonid
- Konfigureeritavad ajastused
- Sujuv vigade taastamine

### Samaaegne töötlemine
- Mitteblokeeriv I/O
- Paralleelne tööriistade täitmine
- Tõhusad asünkroonsed mustrid

## Turvalisuse kaalutlused

### Andmekaitse
- Turvaline API võtmete haldamine
- Sisendi valideerimine
- Väljundi puhastamine

### Võrgu turvalisus
- HTTPS tugi
- Kohalikud vaikimisi lõpp-punktid
- Turvaline tokenite haldamine

### Täitmise ohutus
- Tööriistade filtreerimine
- Sandboxed keskkonnad
- Auditilogimine

## MCP ökosüsteem ja arendus

### MCP projekti ulatus

Mudeli Konteksti Protokolli ökosüsteem sisaldab mitmeid olulisi komponente:

- **[MCP spetsifikatsioon](https://modelcontextprotocol.io/specification/latest)**: Ametlik spetsifikatsioon, mis kirjeldab klientide ja serverite rakendamise nõudeid
- **[MCP SDK-d](https://modelcontextprotocol.io/docs/sdk)**: Erinevate programmeerimiskeelte SDK-d, mis rakendavad MCP-d
- **MCP arendustööriistad**: Tööriistad MCP serverite ja klientide arendamiseks, sealhulgas [MCP Inspector](https://github.com/modelcontextprotocol/inspector)
- **[MCP viite serveri rakendused](https://github.com/modelcontextprotocol/servers)**: MCP serverite viite rakendused

### MCP arendusega alustamine

MCP-ga arendamise alustamiseks:

**Serverite loomine**: [Loo MCP serverid](https://modelcontextprotocol.io/docs/develop/build-server), et pakkuda oma andmeid ja tööriistu

**Klientide loomine**: [Arenda rakendusi](https://modelcontextprotocol.io/docs/develop/build-client), mis ühenduvad MCP serveritega

**Õpi kontseptsioone**: [Mõista põhikontseptsioone](https://modelcontextprotocol.io/docs/learn/architecture) ja MCP arhitektuuri

## Kokkuvõte

SLM-id integreerituna MCP-ga esindavad paradigmat, mis muudab AI-rakenduste arendust. Kombineerides väikeste mudelite tõhususe väliste tööriistade võimekusega, saavad arendajad luua intelligentseid süsteeme, mis on ressursitõhusad ja väga võimekad.

Mudeli Konteksti Protokoll pakub standardiseeritud viisi AI-rakenduste ühendamiseks väliste süsteemidega, sarnaselt USB-C-le, mis pakub universaalset ühendusstandardit elektroonikaseadmetele. See standardiseerimine võimaldab:

- **Sujuvat integreerimist**: Ühendage AI mudelid mitmekesiste andmeallikate ja tööriistadega
- **Ökosüsteemi kasvu**: Loo üks kord, kasuta mitmes AI rakenduses
- **Täiustatud võimekust**: Täienda SLM-e välise funktsionaalsusega
- **Reaalajas uuendusi**: Toeta dünaamilisi ja reageerivaid AI rakendusi

Peamised järeldused:
- MCP on avatud standard, mis ühendab AI rakendused ja välised süsteemid
- Protokoll toetab tööriistu, ressursse ja juhiseid kui põhiprimitiive
- Reaalajas teavitused võimaldavad dünaamilisi ja reageerivaid rakendusi
- Korralik elutsükli haldus ja vigade käsitlemine on tootmiskasutuseks hädavajalikud
- Ökosüsteem pakub põhjalikke SDK-sid ja arendustööriistu

## Viited ja lisalugemine

### Ametlik MCP dokumentatsioon

- **[Mudeli Konteksti Protokolli ametlik veebisait](https://modelcontextprotocol.io/)** - Täielik dokumentatsioon ja spetsifikatsioonid
- **[MCP alustamise juhend](https://modelcontextprotocol.io/docs/getting-started/intro)** - Sissejuhatus ja põhikontseptsioonid
- **[MCP arhitektuuri ülevaade](https://modelcontextprotocol.io/docs/learn/architecture)** - Detailne tehniline arhitektuur
- **[MCP spetsifikatsioon](https://modelcontextprotocol.io/specification/latest)** - Ametlik protokolli spetsifikatsioon
- **[MCP SDK-de dokumentatsioon](https://modelcontextprotocol.io/docs/sdk)** - Keelepõhised SDK juhendid

### Arendus
- **[Ollama Dokumentatsioon](https://ollama.ai/docs)** - Kohalik LLM-i juurutamise platvorm
- **[vLLM Dokumentatsioon](https://docs.vllm.ai/)** - Kõrge jõudlusega LLM-i teenindus

### Tehnilised standardid ja protokollid

- **[JSON-RPC 2.0 Spetsifikatsioon](https://www.jsonrpc.org/)** - MCP aluseks olev RPC protokoll
- **[JSON Schema](https://json-schema.org/)** - MCP tööriistade skeemi määratlemise standard
- **[OpenAPI Spetsifikatsioon](https://swagger.io/specification/)** - API dokumentatsiooni standard
- **[Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)** - Veebistandard reaalajas uuenduste jaoks

### Tehisintellekti agentide arendamine

- **[Microsoft Agent Framework](https://github.com/microsoft/agent-framework)** - Tootmisvalmis agentide arendamine
- **[LangChain Dokumentatsioon](https://docs.langchain.com/)** - Agentide ja tööriistade integreerimise raamistik
- **[Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/)** - Microsofti AI orkestreerimise SDK

### Tööstusaruanded ja teadusuuringud

- **[Anthropic'i Model Context Protocol Teade](https://www.anthropic.com/news/model-context-protocol)** - MCP algne tutvustus
- **[Väikeste keelemudelite uuring](https://arxiv.org/abs/2410.20011)** - Akadeemiline ülevaade SLM-i uuringutest
- **[Edge AI turuanalüüs](https://www.marketsandmarkets.com/Market-Reports/edge-ai-software-market-74385617.html)** - Tööstuse trendid ja prognoosid
- **[AI agentide arendamise parimad tavad](https://arxiv.org/abs/2309.02427)** - Uuring agentide arhitektuuride kohta

See jaotis pakub alust oma SLM-i toetatud MCP rakenduste loomiseks, avades võimalused automatiseerimiseks, andmetöötluseks ja intelligentsete süsteemide integreerimiseks.

## ➡️ Mis edasi

- [Moodul 7. Edge AI näited](../Module07/README.md)

---

**Lahtiütlus**:  
See dokument on tõlgitud AI tõlketeenuse [Co-op Translator](https://github.com/Azure/co-op-translator) abil. Kuigi püüame tagada täpsust, palume arvestada, et automaatsed tõlked võivad sisaldada vigu või ebatäpsusi. Algne dokument selle algses keeles tuleks pidada autoriteetseks allikaks. Olulise teabe puhul soovitame kasutada professionaalset inimtõlget. Me ei vastuta selle tõlke kasutamisest tulenevate arusaamatuste või valesti tõlgenduste eest.