# Odjeljak 03 - Integracija Model Context Protocol (MCP)

## Uvod u MCP (Model Context Protocol)

Model Context Protocol (MCP) je standard otvorenog koda za povezivanje AI aplikacija s vanjskim sustavima. Korištenjem MCP-a, AI aplikacije poput Claudea ili ChatGPT-a mogu se povezati s izvorima podataka (npr. lokalne datoteke, baze podataka), alatima (npr. tražilice, kalkulatori) i radnim procesima (npr. specijalizirani upiti)—omogućujući im pristup ključnim informacijama i obavljanje zadataka.

Zamislite MCP kao **USB-C priključak za AI aplikacije**. Baš kao što USB-C pruža standardizirani način povezivanja elektroničkih uređaja, MCP pruža standardizirani način povezivanja AI aplikacija s vanjskim sustavima.

### Što MCP omogućuje?

MCP otključava moćne mogućnosti za AI aplikacije:

- **Personalizirani AI asistenti**: Agent može pristupiti vašem Google kalendaru i Notionu, djelujući kao personalizirani AI asistent
- **Napredno generiranje koda**: Claude Code može generirati cijelu web aplikaciju koristeći Figma dizajn
- **Integracija podataka u poduzeću**: Chatbotovi za poduzeća mogu se povezati s više baza podataka unutar organizacije, omogućujući korisnicima analizu podataka putem chata
- **Kreativni radni procesi**: AI modeli mogu kreirati 3D dizajne u Blenderu i ispisati ih pomoću 3D printera
- **Pristup informacijama u stvarnom vremenu**: Povezivanje s vanjskim izvorima podataka za ažurirane informacije
- **Složene operacije u više koraka**: Izvođenje sofisticiranih radnih procesa kombiniranjem više alata i sustava

### Zašto je MCP važan?

MCP donosi koristi cijelom ekosustavu:

**Za programere**: MCP smanjuje vrijeme razvoja i složenost pri izradi ili integraciji AI aplikacija ili agenata.

**Za AI aplikacije**: MCP omogućuje pristup ekosustavu izvora podataka, alata i aplikacija koji poboljšavaju mogućnosti i iskustvo krajnjeg korisnika.

**Za krajnje korisnike**: MCP rezultira sposobnijim AI aplikacijama ili agentima koji mogu pristupiti vašim podacima i poduzeti radnje u vaše ime kada je to potrebno.

## Mali jezični modeli (SLM) u MCP-u

Mali jezični modeli predstavljaju učinkovit pristup implementaciji AI-a, nudeći nekoliko prednosti:

### Prednosti SLM-a
- **Učinkovitost resursa**: Niži zahtjevi za računalnim resursima
- **Brže vrijeme odgovora**: Smanjena latencija za aplikacije u stvarnom vremenu  
- **Isplativost**: Minimalne infrastrukturne potrebe
- **Privatnost**: Mogu raditi lokalno bez prijenosa podataka
- **Prilagodljivost**: Lakše prilagoditi specifičnim domenama

### Zašto SLM-i dobro funkcioniraju s MCP-om

SLM-i u kombinaciji s MCP-om stvaraju moćnu kombinaciju gdje se sposobnosti zaključivanja modela nadopunjuju vanjskim alatima, kompenzirajući manji broj parametara kroz proširenu funkcionalnost.

## Pregled Python MCP SDK-a

Python MCP SDK pruža temelj za izradu aplikacija koje podržavaju MCP. SDK uključuje:

- **Klijentske biblioteke**: Za povezivanje s MCP poslužiteljima
- **Okvir za poslužitelje**: Za izradu prilagođenih MCP poslužitelja
- **Upravitelji protokola**: Za upravljanje komunikacijom
- **Integracija alata**: Za izvršavanje vanjskih funkcija

## Praktična implementacija: Phi-4 MCP klijent

Istražimo stvarnu implementaciju koristeći Microsoftov Phi-4 mini model integriran s MCP mogućnostima.

### Pregled arhitekture MCP-a

MCP slijedi **arhitekturu klijent-poslužitelj** gdje MCP domaćin (AI aplikacija poput Claude Code ili Claude Desktop) uspostavlja veze s jednim ili više MCP poslužitelja. MCP domaćin to postiže stvaranjem jednog MCP klijenta za svaki MCP poslužitelj.

#### Ključni sudionici

- **MCP domaćin**: AI aplikacija koja koordinira i upravlja jednim ili više MCP klijenata
- **MCP klijent**: Komponenta koja održava vezu s MCP poslužiteljem i dobiva kontekst od MCP poslužitelja za MCP domaćina
- **MCP poslužitelj**: Program koji pruža kontekst MCP klijentima

#### Dvoslojna arhitektura

MCP se sastoji od dva različita sloja:

**Sloj podataka**: Definira JSON-RPC bazirani protokol za komunikaciju klijent-poslužitelj, uključujući:
- Upravljanje životnim ciklusom (inicijalizacija veze, pregovaranje sposobnosti)
- Osnovne primitivne funkcije (alati, resursi, upiti)
- Značajke klijenta (uzorkovanje, prikupljanje podataka, zapisivanje)
- Pomoćne značajke (obavijesti, praćenje napretka)

**Transportni sloj**: Definira mehanizme i kanale komunikacije:
- **STDIO transport**: Koristi standardne ulazne/izlazne tokove za lokalne procese (optimalne performanse, bez mrežnih troškova)
- **Streamable HTTP transport**: Koristi HTTP POST s opcionalnim Server-Sent Events za udaljene poslužitelje (podržava standardnu HTTP autentifikaciju)

```
┌─────────────────────────────────────┐
│           MCP Host                  │
│     (AI Application)                │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Client 1                │
│  ┌─────────────────────────────────┐ │
│  │        Data Layer               │ │
│  │  ├── Lifecycle Management       │ │
│  │  ├── Primitives (Tools/Resources)│ │
│  │  └── Notifications              │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │      Transport Layer           │ │
│  │  ├── STDIO Transport           │ │
│  │  └── HTTP Transport            │ │
│  └─────────────────────────────────┘ │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Server 1                │
│    (Local/Remote Context Provider)  │
└─────────────────────────────────────┘
```

### MCP osnovni primitivni elementi

MCP definira primitivne elemente koji specificiraju vrste kontekstualnih informacija koje se mogu dijeliti s AI aplikacijama i raspon radnji koje se mogu izvršiti.

#### Primitivni elementi poslužitelja

MCP definira tri osnovna primitivna elementa koja poslužitelji mogu izložiti:

**Alati**: Izvršne funkcije koje AI aplikacije mogu pozvati za obavljanje radnji
- Primjeri: operacije s datotekama, API pozivi, upiti u bazama podataka
- Metode: `tools/list`, `tools/call`
- Podržavaju dinamičko otkrivanje i izvršenje

**Resursi**: Izvori podataka koji pružaju kontekstualne informacije AI aplikacijama
- Primjeri: sadržaj datoteka, zapisi u bazama podataka, odgovori API-ja
- Metode: `resources/list`, `resources/read`
- Omogućuju pristup strukturiranim podacima

**Upiti**: Ponovno upotrebljivi predlošci koji pomažu strukturirati interakcije s jezičnim modelima
- Primjeri: sistemski upiti, primjeri s malo podataka
- Metode: `prompts/list`, `prompts/get`
- Standardiziraju obrasce interakcije s AI-jem

#### Primitivni elementi klijenta

MCP također definira primitivne elemente koje klijenti mogu izložiti kako bi omogućili bogatije interakcije:

**Uzorkovanje**: Omogućuje poslužiteljima da zatraže dovršavanje jezičnog modela od AI aplikacije klijenta
- Metoda: `sampling/complete`
- Omogućuje razvoj poslužitelja neovisnih o modelu
- Pruža pristup jezičnom modelu domaćina

**Prikupljanje podataka**: Omogućuje poslužiteljima da zatraže dodatne informacije od korisnika
- Metoda: `elicitation/request`
- Omogućuje interakciju s korisnikom i potvrdu
- Podržava dinamičko prikupljanje informacija

**Zapisivanje**: Omogućuje poslužiteljima slanje poruka zapisnika klijentima
- Koristi se za potrebe otklanjanja pogrešaka i praćenja
- Pruža uvid u operacije poslužitelja

### MCP životni ciklus protokola

#### Inicijalizacija i pregovaranje sposobnosti

MCP je protokol sa stanjem koji zahtijeva upravljanje životnim ciklusom. Proces inicijalizacije služi nekoliko ključnih svrha:

1. **Pregovaranje verzije protokola**: Osigurava da klijent i poslužitelj koriste kompatibilne verzije protokola (npr. "2025-06-18")
2. **Otkrivanje sposobnosti**: Svaka strana deklarira podržane značajke i primitivne elemente
3. **Razmjena identiteta**: Pruža informacije o identifikaciji i verziji

```python
# Example initialization request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2025-06-18",
    "capabilities": {
      "elicitation": {},  # Client supports user interaction
      "sampling": {}      # Client can provide LLM completions
    },
    "clientInfo": {
      "name": "edge-ai-client",
      "version": "1.0.0"
    }
  }
}
```

#### Otkrivanje i izvršenje alata

Nakon inicijalizacije, klijenti mogu otkriti i izvršavati alate:

```python
# Discover available tools
tools_response = await session.list_tools()

# Execute a tool
result = await session.call_tool(
    "weather_current",
    {
        "location": "San Francisco",
        "units": "imperial"
    }
)
```

#### Obavijesti u stvarnom vremenu

MCP podržava obavijesti u stvarnom vremenu za dinamička ažuriranja:

```python
# Server sends notification when tools change
{
  "jsonrpc": "2.0",
  "method": "notifications/tools/list_changed"
}

# Client responds by refreshing tool list
await session.list_tools()  # Get updated tools
```

## Početak rada: Vodič korak po korak

### Korak 1: Postavljanje okruženja

Instalirajte potrebne ovisnosti:
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```

### Korak 2: Osnovna konfiguracija

Postavite varijable okruženja:
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```

### Korak 3: Pokretanje vašeg prvog MCP klijenta

**Osnovna Ollama konfiguracija:**
```bash
python ghmodel_mcp_demo.py
```

**Korištenje vLLM pozadinskog sustava:**
```bash
python ghmodel_mcp_demo.py --env vllm
```

**Veza putem Server-Sent Events:**
```bash
python ghmodel_mcp_demo.py --run sse
```

**Prilagođeni MCP poslužitelj:**
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```

### Korak 4: Programska upotreba

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Napredne značajke

### Podrška za više pozadinskih sustava

Implementacija podržava i Ollama i vLLM pozadinske sustave, omogućujući vam odabir prema vašim zahtjevima:

- **Ollama**: Bolje za lokalni razvoj i testiranje
- **vLLM**: Optimizirano za produkciju i scenarije visokog kapaciteta

### Fleksibilni protokoli povezivanja

Podržana su dva načina povezivanja:

**STDIO način**: Izravna komunikacija procesa
- Niža latencija
- Pogodno za lokalne alate
- Jednostavno postavljanje

**SSE način**: Streaming temeljen na HTTP-u
- Mrežno sposobno
- Bolje za distribuirane sustave
- Ažuriranja u stvarnom vremenu

### Mogućnosti integracije alata

Sustav se može integrirati s raznim alatima:
- Web automatizacija (Playwright)
- Operacije s datotekama
- Interakcije s API-jem
- Sistemske naredbe
- Prilagođene funkcije

## Upravljanje pogreškama i najbolje prakse

### Sveobuhvatno upravljanje pogreškama

Implementacija uključuje robusno upravljanje pogreškama za:

**Pogreške povezivanja:**
- Neuspjesi MCP poslužitelja
- Istek vremena mreže
- Problemi s povezivanjem

**Pogreške izvršenja alata:**
- Nedostajući alati
- Validacija parametara
- Neuspjesi izvršenja

**Pogreške obrade odgovora:**
- Problemi s parsiranjem JSON-a
- Nedosljednosti formata
- Anomalije odgovora LLM-a

### Najbolje prakse

1. **Upravljanje resursima**: Koristite asinkrone upravitelje konteksta
2. **Upravljanje pogreškama**: Implementirajte sveobuhvatne try-catch blokove
3. **Zapisivanje**: Omogućite odgovarajuće razine zapisivanja
4. **Sigurnost**: Validirajte ulaze i sanitizirajte izlaze
5. **Performanse**: Koristite poolove veza i predmemoriranje

## Primjene u stvarnom svijetu

### Web automatizacija
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```

### Obrada podataka
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```

### Integracija API-ja
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```

## Optimizacija performansi

### Upravljanje memorijom
- Učinkovito upravljanje poviješću poruka
- Pravilno čišćenje resursa
- Pooling veza

### Mrežna optimizacija
- Asinkrone HTTP operacije
- Konfigurabilni vremenski ograničenja
- Graciozni oporavak od pogrešaka

### Paralelna obrada
- Ne-blokirajući I/O
- Paralelno izvršenje alata
- Učinkoviti asinkroni obrasci

## Sigurnosni aspekti

### Zaštita podataka
- Sigurno upravljanje API ključevima
- Validacija ulaza
- Sanitizacija izlaza

### Sigurnost mreže
- Podrška za HTTPS
- Zadane lokalne krajnje točke
- Sigurno rukovanje tokenima

### Sigurnost izvršenja
- Filtriranje alata
- Okruženja u sandboxu
- Zapisivanje revizija

## MCP ekosustav i razvoj

### Opseg projekta MCP

Ekosustav Model Context Protocol uključuje nekoliko ključnih komponenti:

- **[MCP Specifikacija](https://modelcontextprotocol.io/specification/latest)**: Službena specifikacija koja opisuje zahtjeve za implementaciju klijenata i poslužitelja
- **[MCP SDK-ovi](https://modelcontextprotocol.io/docs/sdk)**: SDK-ovi za različite programske jezike koji implementiraju MCP
- **Razvojni alati MCP-a**: Alati za razvoj MCP poslužitelja i klijenata, uključujući [MCP Inspector](https://github.com/modelcontextprotocol/inspector)
- **[Referentne implementacije MCP poslužitelja](https://github.com/modelcontextprotocol/servers)**: Referentne implementacije MCP poslužitelja

### Početak razvoja MCP-a

Za početak izrade s MCP-om:

**Izrada poslužitelja**: [Kreirajte MCP poslužitelje](https://modelcontextprotocol.io/docs/develop/build-server) za izlaganje vaših podataka i alata

**Izrada klijenata**: [Razvijajte aplikacije](https://modelcontextprotocol.io/docs/develop/build-client) koje se povezuju s MCP poslužiteljima

**Učenje koncepata**: [Razumite osnovne koncepte](https://modelcontextprotocol.io/docs/learn/architecture) i arhitekturu MCP-a

## Zaključak

SLM-i integrirani s MCP-om predstavljaju promjenu paradigme u razvoju AI aplikacija. Kombiniranjem učinkovitosti malih modela s moći vanjskih alata, programeri mogu stvoriti inteligentne sustave koji su i resursno učinkoviti i vrlo sposobni.

Model Context Protocol pruža standardizirani način povezivanja AI aplikacija s vanjskim sustavima, slično kao što USB-C pruža univerzalni standard povezivanja za elektroničke uređaje. Ova standardizacija omogućuje:

- **Besprijekornu integraciju**: Povezivanje AI modela s raznovrsnim izvorima podataka i alatima
- **Rast ekosustava**: Jednom izgrađeno, koristi se u više AI aplikacija
- **Poboljšane mogućnosti**: Nadopunjavanje SLM-a vanjskom funkcionalnošću
- **Ažuriranja u stvarnom vremenu**: Podrška za dinamične, responzivne AI aplikacije

Ključne točke:
- MCP je otvoreni standard koji povezuje AI aplikacije i vanjske sustave
- Protokol podržava alate, resurse i upite kao osnovne primitivne elemente
- Obavijesti u stvarnom vremenu omogućuju dinamične, responzivne aplikacije
- Pravilno upravljanje životnim ciklusom i rukovanje pogreškama ključni su za produkcijsku upotrebu
- Ekosustav pruža sveobuhvatne SDK-ove i razvojne alate

## Reference i dodatno čitanje

### Službena MCP dokumentacija

- **[Službena stranica Model Context Protocol](https://modelcontextprotocol.io/)** - Kompletna dokumentacija i specifikacije
- **[Vodič za početak rada s MCP-om](https://modelcontextprotocol.io/docs/getting-started/intro)** - Uvod i osnovni koncepti
- **[Pregled arhitekture MCP-a](https://modelcontextprotocol.io/docs/learn/architecture)** - Detaljna tehnička arhitektura
- **[MCP Specifikacija](https://modelcontextprotocol.io/specification/latest)** - Službena specifikacija protokola
- **[Dokumentacija MCP SDK-ova](https://modelcontextprotocol.io/docs/sdk)** - Vodiči za SDK-ove specifične za jezik

### Resursi za razvoj

- **[MCP za početnike](https://aka.ms/mcp-for-beginners)** - Sveobuhvatan vodič za početnike o Model Context Protocolu
- **[MCP GitHub organizacija](https://github.com/modelcontextprotocol)** - Službeni repozitoriji i primjeri
- **[Repozitorij MCP poslužitelja](https://github.com/modelcontextprotocol/servers)** - Referentne implementacije poslužitelja
- **[MCP Inspector](https://github.com/modelcontext
- **[Ollama Dokumentacija](https://ollama.ai/docs)** - Platforma za lokalno postavljanje LLM-a
- **[vLLM Dokumentacija](https://docs.vllm.ai/)** - Visokoučinkovito posluživanje LLM-a

### Tehnički standardi i protokoli

- **[JSON-RPC 2.0 Specifikacija](https://www.jsonrpc.org/)** - Temeljni RPC protokol koji koristi MCP
- **[JSON Schema](https://json-schema.org/)** - Standard za definiranje shema za MCP alate
- **[OpenAPI Specifikacija](https://swagger.io/specification/)** - Standard za dokumentaciju API-ja
- **[Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)** - Web standard za ažuriranja u stvarnom vremenu

### Razvoj AI agenata

- **[Microsoft Agent Framework](https://github.com/microsoft/agent-framework)** - Razvoj agenata spremnih za produkciju
- **[LangChain Dokumentacija](https://docs.langchain.com/)** - Okvir za integraciju agenata i alata
- **[Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/)** - Microsoftov SDK za orkestraciju AI-a

### Industrijski izvještaji i istraživanja

- **[Anthropicova najava Model Context Protocola](https://www.anthropic.com/news/model-context-protocol)** - Izvorno predstavljanje MCP-a
- **[Pregled malih jezičnih modela](https://arxiv.org/abs/2410.20011)** - Akademski pregled istraživanja SLM-a
- **[Analiza tržišta Edge AI-a](https://www.marketsandmarkets.com/Market-Reports/edge-ai-software-market-74385617.html)** - Trendovi i prognoze u industriji
- **[Najbolje prakse za razvoj AI agenata](https://arxiv.org/abs/2309.02427)** - Istraživanje arhitektura agenata

Ovaj odjeljak pruža temelj za izgradnju vlastitih MCP aplikacija temeljenih na SLM-u, otvarajući mogućnosti za automatizaciju, obradu podataka i integraciju inteligentnih sustava.

## ➡️ Što dalje

- [Modul 7. Primjeri Edge AI-a](../Module07/README.md)

---

**Izjava o odricanju odgovornosti**:  
Ovaj dokument je preveden pomoću AI usluge za prevođenje [Co-op Translator](https://github.com/Azure/co-op-translator). Iako nastojimo osigurati točnost, imajte na umu da automatski prijevodi mogu sadržavati pogreške ili netočnosti. Izvorni dokument na izvornom jeziku treba smatrati autoritativnim izvorom. Za ključne informacije preporučuje se profesionalni prijevod od strane čovjeka. Ne odgovaramo za nesporazume ili pogrešna tumačenja koja proizlaze iz korištenja ovog prijevoda.