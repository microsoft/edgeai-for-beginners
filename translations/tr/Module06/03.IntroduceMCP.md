# Bölüm 03 - Model Context Protocol (MCP) Entegrasyonu

## MCP'ye Giriş (Model Context Protocol)

Model Context Protocol (MCP), yapay zeka uygulamalarını harici sistemlere bağlamak için açık kaynaklı bir standarttır. MCP kullanarak Claude veya ChatGPT gibi yapay zeka uygulamaları, veri kaynaklarına (örneğin, yerel dosyalar, veritabanları), araçlara (örneğin, arama motorları, hesap makineleri) ve iş akışlarına (örneğin, özel istemler) bağlanabilir—bu sayede önemli bilgilere erişebilir ve görevleri yerine getirebilir.

MCP'yi yapay zeka uygulamaları için bir **USB-C portu** gibi düşünebilirsiniz. USB-C, elektronik cihazları bağlamak için standart bir yöntem sağladığı gibi, MCP de yapay zeka uygulamalarını harici sistemlere bağlamak için standart bir yöntem sağlar.

### MCP Neler Sağlayabilir?

MCP, yapay zeka uygulamaları için güçlü yetenekler sunar:

- **Kişiselleştirilmiş Yapay Zeka Asistanları**: Google Takviminiz ve Notion'a erişebilen, daha kişiselleştirilmiş bir yapay zeka asistanı gibi davranan ajanlar
- **Gelişmiş Kod Üretimi**: Claude Code, bir Figma tasarımını kullanarak tüm bir web uygulaması oluşturabilir
- **Kurumsal Veri Entegrasyonu**: Kurumsal sohbet botları, bir organizasyon genelindeki birden fazla veritabanına bağlanabilir ve kullanıcıların sohbet yoluyla veri analiz etmesini sağlar
- **Yaratıcı İş Akışları**: Yapay zeka modelleri Blender'da 3D tasarımlar oluşturabilir ve bunları 3D yazıcıyla yazdırabilir
- **Gerçek Zamanlı Bilgi Erişimi**: Güncel bilgilere erişmek için harici veri kaynaklarına bağlanabilir
- **Karmaşık Çok Adımlı Operasyonlar**: Birden fazla araç ve sistemi birleştirerek sofistike iş akışlarını gerçekleştirebilir

### MCP Neden Önemlidir?

MCP ekosistem genelinde faydalar sağlar:

**Geliştiriciler İçin**: MCP, bir yapay zeka uygulaması veya ajanı oluştururken ya da entegre ederken geliştirme süresini ve karmaşıklığını azaltır.

**Yapay Zeka Uygulamaları İçin**: MCP, veri kaynakları, araçlar ve uygulamalardan oluşan bir ekosisteme erişim sağlar, bu da yetenekleri artırır ve son kullanıcı deneyimini iyileştirir.

**Son Kullanıcılar İçin**: MCP, gerektiğinde verilerinize erişebilen ve sizin adınıza işlem yapabilen daha yetenekli yapay zeka uygulamaları veya ajanlar sağlar.

## MCP'deki Küçük Dil Modelleri (SLM'ler)

Küçük Dil Modelleri, yapay zeka dağıtımında verimli bir yaklaşımı temsil eder ve çeşitli avantajlar sunar:

### SLM'lerin Avantajları
- **Kaynak Verimliliği**: Daha düşük hesaplama gereksinimleri
- **Daha Hızlı Yanıt Süreleri**: Gerçek zamanlı uygulamalar için azaltılmış gecikme  
- **Maliyet Etkinliği**: Minimum altyapı gereksinimleri
- **Gizlilik**: Verilerin aktarımı olmadan yerel olarak çalışabilir
- **Özelleştirme**: Belirli alanlar için daha kolay uyarlanabilir

### SLM'ler MCP ile Neden İyi Çalışır?

SLM'ler MCP ile birleştirildiğinde, modelin akıl yürütme yetenekleri harici araçlarla desteklenir ve daha küçük parametre sayısını artırılmış işlevsellik ile telafi eder.

## Python MCP SDK'ya Genel Bakış

Python MCP SDK, MCP özellikli uygulamalar oluşturmak için temel sağlar. SDK şunları içerir:

- **İstemci Kütüphaneleri**: MCP sunucularına bağlanmak için
- **Sunucu Çerçevesi**: Özel MCP sunucuları oluşturmak için
- **Protokol İşleyicileri**: İletişimi yönetmek için
- **Araç Entegrasyonu**: Harici işlevleri yürütmek için

## Pratik Uygulama: Phi-4 MCP İstemcisi

Microsoft'un MCP özellikleriyle entegre edilmiş Phi-4 mini modelini kullanarak gerçek dünya uygulamasını inceleyelim.

### MCP Mimarisine Genel Bakış

MCP, bir MCP ana bilgisayarının (Claude Code veya Claude Desktop gibi bir yapay zeka uygulaması) bir veya daha fazla MCP sunucusuna bağlantı kurduğu **istemci-sunucu mimarisini** takip eder. MCP ana bilgisayarı, her MCP sunucusu için bir MCP istemcisi oluşturarak bunu gerçekleştirir.

#### Temel Katılımcılar

- **MCP Ana Bilgisayarı**: Bir veya birden fazla MCP istemcisini koordine eden ve yöneten yapay zeka uygulaması
- **MCP İstemcisi**: MCP ana bilgisayarının kullanması için MCP sunucusundan bağlam alan ve bir MCP sunucusuna bağlantıyı sürdüren bir bileşen
- **MCP Sunucusu**: MCP istemcilerine bağlam sağlayan bir program

#### İki Katmanlı Mimari

MCP iki farklı katmandan oluşur:

**Veri Katmanı**: İstemci-sunucu iletişimi için JSON-RPC tabanlı protokolü tanımlar, şunları içerir:
- Yaşam döngüsü yönetimi (bağlantı başlatma, yetenek müzakeresi)
- Temel öğeler (araçlar, kaynaklar, istemler)
- İstemci özellikleri (örnekleme, bilgi toplama, günlük kaydı)
- Yardımcı özellikler (bildirimler, ilerleme takibi)

**Taşıma Katmanı**: İletişim mekanizmalarını ve kanalları tanımlar:
- **STDIO Taşıma**: Yerel işlemler için standart giriş/çıkış akışlarını kullanır (optimal performans, ağ yükü yok)
- **Akışlı HTTP Taşıma**: Uzaktan sunucular için HTTP POST ve isteğe bağlı Sunucu Tarafından Gönderilen Olayları kullanır (standart HTTP kimlik doğrulamasını destekler)

```
┌─────────────────────────────────────┐
│           MCP Host                  │
│     (AI Application)                │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Client 1                │
│  ┌─────────────────────────────────┐ │
│  │        Data Layer               │ │
│  │  ├── Lifecycle Management       │ │
│  │  ├── Primitives (Tools/Resources)│ │
│  │  └── Notifications              │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │      Transport Layer           │ │
│  │  ├── STDIO Transport           │ │
│  │  └── HTTP Transport            │ │
│  └─────────────────────────────────┘ │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│         MCP Server 1                │
│    (Local/Remote Context Provider)  │
└─────────────────────────────────────┘
```

### MCP Temel Öğeleri

MCP, yapay zeka uygulamalarıyla paylaşılabilecek bağlamsal bilgi türlerini ve gerçekleştirilebilecek eylemleri belirten öğeleri tanımlar.

#### Sunucu Öğeleri

MCP, sunucuların açığa çıkarabileceği üç temel öğeyi tanımlar:

**Araçlar**: Yapay zeka uygulamalarının eylemleri gerçekleştirmek için çağırabileceği çalıştırılabilir işlevler
- Örnekler: dosya işlemleri, API çağrıları, veritabanı sorguları
- Yöntemler: `tools/list`, `tools/call`
- Dinamik keşif ve yürütmeyi destekler

**Kaynaklar**: Yapay zeka uygulamalarına bağlamsal bilgi sağlayan veri kaynakları
- Örnekler: dosya içerikleri, veritabanı kayıtları, API yanıtları
- Yöntemler: `resources/list`, `resources/read`
- Yapılandırılmış verilere erişimi sağlar

**İstemler**: Dil modelleriyle etkileşimleri yapılandırmaya yardımcı olan yeniden kullanılabilir şablonlar
- Örnekler: sistem istemleri, birkaç örnekli istemler
- Yöntemler: `prompts/list`, `prompts/get`
- Yapay zeka etkileşim kalıplarını standartlaştırır

#### İstemci Öğeleri

MCP ayrıca daha zengin etkileşimleri mümkün kılmak için istemcilerin açığa çıkarabileceği öğeleri tanımlar:

**Örnekleme**: Sunucuların istemcinin yapay zeka uygulamasından dil modeli tamamlamaları talep etmesine olanak tanır
- Yöntem: `sampling/complete`
- Modelden bağımsız sunucu geliştirmeyi mümkün kılar
- Ana bilgisayarın dil modeline erişim sağlar

**Bilgi Toplama**: Sunucuların kullanıcılardan ek bilgi talep etmesine olanak tanır
- Yöntem: `elicitation/request`
- Kullanıcı etkileşimi ve onayını mümkün kılar
- Dinamik bilgi toplamayı destekler

**Günlük Kaydı**: Sunucuların istemcilere günlük mesajları göndermesini sağlar
- Hata ayıklama ve izleme amaçlı kullanılır
- Sunucu işlemlerine görünürlük sağlar

### MCP Protokol Yaşam Döngüsü

#### Başlatma ve Yetenek Müzakeresi

MCP, yaşam döngüsü yönetimi gerektiren durumlu bir protokoldür. Başlatma süreci birkaç kritik amacı yerine getirir:

1. **Protokol Sürüm Müzakeresi**: Hem istemci hem de sunucunun uyumlu protokol sürümleri kullandığından emin olur (örneğin, "2025-06-18")
2. **Yetenek Keşfi**: Her taraf desteklenen özellikleri ve öğeleri bildirir
3. **Kimlik Değişimi**: Kimlik ve sürüm bilgisi sağlar

```python
# Example initialization request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2025-06-18",
    "capabilities": {
      "elicitation": {},  # Client supports user interaction
      "sampling": {}      # Client can provide LLM completions
    },
    "clientInfo": {
      "name": "edge-ai-client",
      "version": "1.0.0"
    }
  }
}
```

#### Araç Keşfi ve Yürütme

Başlatmadan sonra, istemciler araçları keşfedebilir ve çalıştırabilir:

```python
# Discover available tools
tools_response = await session.list_tools()

# Execute a tool
result = await session.call_tool(
    "weather_current",
    {
        "location": "San Francisco",
        "units": "imperial"
    }
)
```

#### Gerçek Zamanlı Bildirimler

MCP, dinamik güncellemeler için gerçek zamanlı bildirimleri destekler:

```python
# Server sends notification when tools change
{
  "jsonrpc": "2.0",
  "method": "notifications/tools/list_changed"
}

# Client responds by refreshing tool list
await session.list_tools()  # Get updated tools
```

## Başlangıç: Adım Adım Kılavuz

### Adım 1: Ortam Kurulumu

Gerekli bağımlılıkları yükleyin:
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```

### Adım 2: Temel Yapılandırma

Ortam değişkenlerinizi ayarlayın:
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```

### Adım 3: İlk MCP İstemcinizi Çalıştırma

**Temel Ollama Kurulumu:**
```bash
python ghmodel_mcp_demo.py
```

**vLLM Arka Uç Kullanımı:**
```bash
python ghmodel_mcp_demo.py --env vllm
```

**Sunucu Tarafından Gönderilen Olaylar Bağlantısı:**
```bash
python ghmodel_mcp_demo.py --run sse
```

**Özel MCP Sunucusu:**
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```

### Adım 4: Programatik Kullanım

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Gelişmiş Özellikler

### Çoklu Arka Uç Desteği

Uygulama, gereksinimlerinize bağlı olarak Ollama ve vLLM arka uçlarını destekler:

- **Ollama**: Yerel geliştirme ve test için daha iyi
- **vLLM**: Üretim ve yüksek verim senaryoları için optimize edilmiş

### Esnek Bağlantı Protokolleri

İki bağlantı modu desteklenir:

**STDIO Modu**: Doğrudan işlem iletişimi
- Daha düşük gecikme
- Yerel araçlar için uygun
- Basit kurulum

**SSE Modu**: HTTP tabanlı akış
- Ağ uyumlu
- Dağıtık sistemler için daha iyi
- Gerçek zamanlı güncellemeler

### Araç Entegrasyon Yetenekleri

Sistem çeşitli araçlarla entegre olabilir:
- Web otomasyonu (Playwright)
- Dosya işlemleri
- API etkileşimleri
- Sistem komutları
- Özel işlevler

## Hata Yönetimi ve En İyi Uygulamalar

### Kapsamlı Hata Yönetimi

Uygulama, aşağıdaki durumlar için sağlam hata yönetimi içerir:

**Bağlantı Hataları:**
- MCP sunucu hataları
- Ağ zaman aşımı
- Bağlantı sorunları

**Araç Yürütme Hataları:**
- Eksik araçlar
- Parametre doğrulama
- Yürütme hataları

**Yanıt İşleme Hataları:**
- JSON ayrıştırma sorunları
- Format tutarsızlıkları
- LLM yanıt anomalileri

### En İyi Uygulamalar

1. **Kaynak Yönetimi**: Asenkron bağlam yöneticileri kullanın
2. **Hata Yönetimi**: Kapsamlı try-catch blokları uygulayın
3. **Günlük Kaydı**: Uygun günlük seviyelerini etkinleştirin
4. **Güvenlik**: Girdileri doğrulayın ve çıktıları temizleyin
5. **Performans**: Bağlantı havuzu ve önbellekleme kullanın

## Gerçek Dünya Uygulamaları

### Web Otomasyonu
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```

### Veri İşleme
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```

### API Entegrasyonu
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```

## Performans Optimizasyonu

### Bellek Yönetimi
- Verimli mesaj geçmişi işleme
- Uygun kaynak temizliği
- Bağlantı havuzu

### Ağ Optimizasyonu
- Asenkron HTTP işlemleri
- Yapılandırılabilir zaman aşımı
- Zarif hata kurtarma

### Eşzamanlı İşleme
- Engellemeyen I/O
- Paralel araç yürütme
- Verimli asenkron desenler

## Güvenlik Hususları

### Veri Koruma
- Güvenli API anahtarı yönetimi
- Girdi doğrulama
- Çıktı temizleme

### Ağ Güvenliği
- HTTPS desteği
- Yerel uç nokta varsayılanları
- Güvenli token yönetimi

### Yürütme Güvenliği
- Araç filtreleme
- Kumlanmış ortamlar
- Denetim günlüğü

## MCP Ekosistemi ve Geliştirme

### MCP Proje Kapsamı

Model Context Protocol ekosistemi birkaç önemli bileşeni içerir:

- **[MCP Spesifikasyonu](https://modelcontextprotocol.io/specification/latest)**: İstemci ve sunucular için uygulama gereksinimlerini özetleyen resmi spesifikasyon
- **[MCP SDK'ları](https://modelcontextprotocol.io/docs/sdk)**: MCP'yi uygulayan farklı programlama dilleri için SDK'lar
- **MCP Geliştirme Araçları**: MCP sunucuları ve istemcileri geliştirmek için araçlar, [MCP Inspector](https://github.com/modelcontextprotocol/inspector) dahil
- **[MCP Referans Sunucu Uygulamaları](https://github.com/modelcontextprotocol/servers)**: MCP sunucularının referans uygulamaları

### MCP Geliştirme ile Başlama

MCP ile geliştirmeye başlamak için:

**Sunucular Oluşturun**: [MCP sunucuları oluşturun](https://modelcontextprotocol.io/docs/develop/build-server) ve verilerinizi ve araçlarınızı açığa çıkarın

**İstemciler Oluşturun**: [Uygulamalar geliştirin](https://modelcontextprotocol.io/docs/develop/build-client) ve MCP sunucularına bağlanın

**Kavramları Öğrenin**: [Temel kavramları](https://modelcontextprotocol.io/docs/learn/architecture) ve MCP mimarisini anlayın

## Sonuç

MCP ile entegre edilmiş SLM'ler, yapay zeka uygulama geliştirmede bir paradigma değişimini temsil eder. Küçük modellerin verimliliğini harici araçların gücüyle birleştirerek, geliştiriciler hem kaynak açısından verimli hem de oldukça yetenekli akıllı sistemler oluşturabilir.

Model Context Protocol, yapay zeka uygulamalarını harici sistemlere bağlamak için standart bir yöntem sağlar, tıpkı USB-C'nin elektronik cihazlar için evrensel bir bağlantı standardı sağlaması gibi. Bu standardizasyon şunları mümkün kılar:

- **Sorunsuz Entegrasyon**: Yapay zeka modellerini çeşitli veri kaynaklarına ve araçlara bağlayın
- **Ekosistem Büyümesi**: Bir kez oluşturun, birden fazla yapay zeka uygulamasında kullanın
- **Gelişmiş Yetenekler**: SLM'leri harici işlevsellikle destekleyin
- **Gerçek Zamanlı Güncellemeler**: Dinamik, duyarlı yapay zeka uygulamalarını destekleyin

Önemli çıkarımlar:
- MCP, yapay zeka uygulamaları ile harici sistemler arasında köprü kuran açık bir standarttır
- Protokol, araçlar, kaynaklar ve istemler gibi temel öğeleri destekler
- Gerçek zamanlı bildirimler dinamik, duyarlı uygulamaları mümkün kılar
- Üretim kullanımı için uygun yaşam döngüsü yönetimi ve hata yönetimi gereklidir
- Ekosistem, kapsamlı SDK'lar ve geliştirme araçları sağlar

## Kaynaklar ve Daha Fazla Okuma

### Resmi MCP Belgeleri

- **[Model Context Protocol Resmi Sitesi](https://modelcontextprotocol.io/)** - Tam belgeler ve spesifikasyonlar
- **[MCP Başlangıç Kılavuzu](https://modelcontextprotocol.io/docs/getting-started/intro)** - Giriş ve temel kavramlar
- **[MCP Mimari Genel Bakış](https://modelcontextprotocol.io/docs/learn/architecture)** - Ayrıntılı teknik mimari
- **[MCP Spesifikasyonu](https://modelcontextprotocol.io/specification/latest)** - Resmi protokol spesifikasyonu
- **[MCP SDK Belgeleri](https://modelcontextprotocol.io/docs/sdk)** - Dil spesifik SDK kılavuzları

### Geliştirme Kaynakları

- **[MCP için Yeni Başlayanlar](https://aka.ms/mcp-for-beginners)** - Model Context Protocol için kapsamlı başlangıç kılavuzu
- **[MCP GitHub Organizasyonu](https://github.com/modelcontextprotocol)** - Resmi depolar ve örnekler
- **[MCP Sunucu Deposu](https://github.com/modelcontextprotocol/servers)** - Referans sunucu uygulamaları
- **[MCP Inspector](https://github.com/modelcontextprotocol/inspector)** - G
- **[Ollama Belgeleri](https://ollama.ai/docs)** - Yerel LLM dağıtım platformu
- **[vLLM Belgeleri](https://docs.vllm.ai/)** - Yüksek performanslı LLM hizmeti

### Teknik Standartlar ve Protokoller

- **[JSON-RPC 2.0 Spesifikasyonu](https://www.jsonrpc.org/)** - MCP tarafından kullanılan temel RPC protokolü
- **[JSON Şeması](https://json-schema.org/)** - MCP araçları için şema tanımlama standardı
- **[OpenAPI Spesifikasyonu](https://swagger.io/specification/)** - API dokümantasyon standardı
- **[Sunucu Gönderimli Olaylar (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)** - Gerçek zamanlı güncellemeler için web standardı

### AI Temsilci Geliştirme

- **[Microsoft Agent Framework](https://github.com/microsoft/agent-framework)** - Üretime hazır temsilci geliştirme
- **[LangChain Belgeleri](https://docs.langchain.com/)** - Temsilci ve araç entegrasyon çerçevesi
- **[Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/)** - Microsoft'un AI orkestrasyon SDK'sı

### Sektör Raporları ve Araştırmalar

- **[Anthropic'in Model Context Protocol Duyurusu](https://www.anthropic.com/news/model-context-protocol)** - MCP'nin orijinal tanıtımı
- **[Küçük Dil Modelleri Araştırması](https://arxiv.org/abs/2410.20011)** - SLM araştırmalarına yönelik akademik inceleme
- **[Edge AI Pazar Analizi](https://www.marketsandmarkets.com/Market-Reports/edge-ai-software-market-74385617.html)** - Sektör trendleri ve tahminleri
- **[AI Temsilci Geliştirme En İyi Uygulamaları](https://arxiv.org/abs/2309.02427)** - Temsilci mimarileri üzerine araştırma

Bu bölüm, kendi SLM destekli MCP uygulamalarınızı oluşturmanız için temel sağlar ve otomasyon, veri işleme ve akıllı sistem entegrasyonu için yeni olanaklar sunar.

## ➡️ Sırada ne var

- [Modül 7. Edge AI örnekleri](../Module07/README.md)

---

**Feragatname**:  
Bu belge, AI çeviri hizmeti [Co-op Translator](https://github.com/Azure/co-op-translator) kullanılarak çevrilmiştir. Doğruluk için çaba göstersek de, otomatik çevirilerin hata veya yanlışlıklar içerebileceğini lütfen unutmayın. Belgenin orijinal dili, yetkili kaynak olarak kabul edilmelidir. Kritik bilgiler için profesyonel insan çevirisi önerilir. Bu çevirinin kullanımından kaynaklanan yanlış anlamalar veya yanlış yorumlamalar için sorumluluk kabul etmiyoruz.